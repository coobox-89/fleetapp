<%- include('partials/header', { title: "Insight", user: user }) %>

<div class="max-w-7xl mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6 text-center">Insight Dashboard</h1>

  <!-- Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-car-side text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2"><%= totalCars %></p>
      <p class="text-sm">Totale Auto</p>
    </div>

    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-user-check text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2"><%= assignedCars %></p>
      <p class="text-sm">Auto Assegnate</p>
    </div>

    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-car text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2"><%= availableCars %></p>
      <p class="text-sm">Auto Disponibili</p>
    </div>

    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-tools text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2"><%= maintenanceCars %></p>
      <p class="text-sm">In Manutenzione</p>
    </div>

    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-dollar-sign text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2">€<%= totalMonthlyCost %></p>
      <p class="text-sm">Totale Costo Mese</p>
    </div>

    <div class="bg-gray-800 p-4 rounded shadow text-center">
      <i class="fas fa-euro-sign text-3xl" style="color: #66cc66;"></i>
      <p class="font-bold text-xl mt-2">€<%= totalAnnualCost %></p>
      <p class="text-sm">Totale Costo Annuo</p>
    </div>
  </div>

  <!-- Griglia per i grafici: Affiancati su desktop, impilati su mobile -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Grafico: Distribuzione per Stato -->
    <div class="bg-gray-800 p-6 rounded shadow flex flex-col items-center">
        <h2 class="text-2xl font-bold mb-4 text-center">Distribuzione per Stato</h2>
        <div class="w-60 h-60 flex justify-center">
            <canvas id="statusChart"></canvas>
        </div>
    </div>
    
    <!-- Grafico: Classifica Auto per Marca e Modello -->
    <div class="bg-gray-800 p-6 rounded shadow flex flex-col items-center">
      <h2 class="text-2xl font-bold mb-4 text-center">Classifica Auto per Marca e Modello</h2>
      <div class="w-full flex justify-center">
        <canvas id="classificationChart"></canvas>
      </div>
    </div>
  </div>


<!-- Includi Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Grafico a ciambella per la distribuzione degli status
  const ctxStatus = document.getElementById('statusChart').getContext('2d');
  new Chart(ctxStatus, {
    type: 'doughnut',
    data: {
      labels: ['Assegnate', 'Disponibili', 'In Manutenzione'],
      datasets: [{
        data: [<%= assignedCars %>, <%= availableCars %>, <%= maintenanceCars %>],
        backgroundColor: ['#66ff66', '#3498db', '#e74c3c']
      }]
    },
    options: {
      plugins: {
        legend: { display: false }
      }
    }
  });

  // Grafico a barre per la classifica per marca e modello
  const ctxClass = document.getElementById('classificationChart').getContext('2d');
  new Chart(ctxClass, {
    type: 'bar',
    data: {
      labels: <%- JSON.stringify(classificationData.map(item => item.brand + " " + item.model)) %>,
      datasets: [{
        label: 'Numero di Auto',
        data: <%- JSON.stringify(classificationData.map(item => item.count)) %>,
        backgroundColor: '#66ff66'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

<%- include('partials/footer') %>
